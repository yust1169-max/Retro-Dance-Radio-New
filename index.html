<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Dance Radio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background-color: #0d0d0d; font-family: 'Inter', sans-serif; color: white; margin: 0; overflow: hidden; }
        .glass-rose { background: rgba(45, 0, 10, 0.85); backdrop-filter: blur(30px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .bg-sphere { position: fixed; width: 80vw; height: 80vw; background: radial-gradient(circle, rgba(225, 29, 72, 0.2) 0%, transparent 70%); z-index: -1; filter: blur(100px); animation: move 30s infinite alternate linear; }
        @keyframes move { from { transform: translate(-15%, -15%); } to { transform: translate(15%, 15%); } }
        
        .cover-container {
            width: 320px; height: 320px; margin: 0 auto 30px;
            background: #1a1a1a; border-radius: 40px; overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            display: flex; align-items: center; justify-content: center;
        }
        #cover { width: 100%; height: 100%; object-fit: cover; }
        audio { filter: invert(100%) hue-rotate(150deg) brightness(1.2); width: 100%; margin-top: 20px; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">
    <div class="bg-sphere"></div>
    <div class="glass-rose p-10 rounded-[48px] text-center max-w-lg w-full mx-4 shadow-2xl">
        <div class="cover-container">
            <img id="cover" src="https://i.postimg.cc/28VKXjCx/logo.png" alt="Retro Dance Radio">
        </div>
        <div class="track-info">
            <h1 class="text-xl font-black uppercase italic tracking-tighter mb-2">Retro<span class="text-rose-600">Dance</span> Radio</h1>
            <div id="artist" class="text-rose-500 font-bold uppercase tracking-widest text-xs mb-1">...</div>
            <div id="title" class="text-2xl font-black uppercase italic tracking-tighter mb-8 leading-tight">Загрузка...</div>
        </div>
        <audio id="player" controls autoplay><source src="https://stream.laut.fm/retrodance" type="audio/mpeg"></audio>
        <p class="text-[10px] mt-8 opacity-40 uppercase tracking-[1em]">Retro Dance 2026</p>
    </div>

    <script>
        const coverImg = document.getElementById('cover');
        const artistEl = document.getElementById('artist');
        const titleEl = document.getElementById('title');
        const STATION_LOGO = "https://i.postimg.cc/28VKXjCx/logo.png";

        async function updateNowPlaying() {
            try {
                const res = await fetch('https://api.laut.fm/station/retrodance/current_song?t=' + Date.now());
                const data = await res.json();
                
                if (data) {
                    const sTitle = data.title || "Эфир";
                    const sArtist = data.artist?.name || "Retro Radio";
                    
                    titleEl.innerText = sTitle;
                    artistEl.innerText = sArtist;
                    
                    // Проверяем обложку от Laut.fm
                    let rawImg = data.image_medium || data.image_large || data.artist?.image_medium;
                    
                    // Если Laut.fm дал картинку — используем её, если нет — «железно» ставим твой логотип
                    let finalImg = rawImg ? rawImg.replace('http://', 'https://') : STATION_LOGO;
                    
                    if (coverImg.src !== finalImg) {
                        coverImg.src = finalImg;
                    }

                    // Обновляем MediaSession (для экрана блокировки)
                    if ('mediaSession' in navigator) {
                        navigator.mediaSession.metadata = new MediaMetadata({
                            title: sTitle,
                            artist: sArtist,
                            artwork: [{ src: finalImg, sizes: '512x512', type: 'image/png' }]
                        });
                    }
                }
            } catch (e) { 
                coverImg.src = STATION_LOGO;
            }
        }

        // Если картинка от Laut.fm «битая» или не загрузилась — ставим логотип
        coverImg.onerror = function() { 
            this.src = STATION_LOGO; 
        };

        updateNowPlaying();
        setInterval(updateNowPlaying, 10000);
    </script>
</body>
</html>