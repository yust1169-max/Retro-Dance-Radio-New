<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Retro Dance Radio</title>

<link rel="apple-touch-icon" href="https://i.postimg.cc/28VKXjCx/logo.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0d0d0d">

<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
body {
  margin: 0;
  background: #0d0d0d;
  color: #fff;
  font-family: Inter, system-ui, sans-serif;
}
.glass {
  background: rgba(45,0,10,.85);
  backdrop-filter: blur(30px);
  border: 1px solid rgba(255,255,255,.1);
}
</style>
</head>

<body>

<!-- ðŸŽ§ ÐÐ£Ð”Ð˜Ðž Ð’ÐÐ• REACT -->
<audio id="radio-player" crossorigin="anonymous"></audio>

<div id="root"></div>

<script>
/* ====== Ð“Ð›ÐžÐ‘ÐÐ›Ð¬ÐÐ«Ð™ ÐŸÐ›Ð•Ð•Ð  ====== */
window.RadioPlayer = (() => {
  const audio = document.getElementById("radio-player");
  let currentStream = null;

  const STREAMS = {
    high: "https://radio.retrodanceradio.com/listen/retro_dance_radio/radio.AAC",
    low: "https://radio.retrodanceradio.com/listen/retro_dance_radio/radio32.AAC"
  };

  const updateMedia = (title, artist, image) => {
    if ("mediaSession" in navigator) {
      navigator.mediaSession.metadata = new MediaMetadata({
        title,
        artist,
        album: "Retro Dance Radio",
        artwork: [{ src: image, sizes: "512x512", type: "image/png" }]
      });
    }
  };

  return {
    play(quality, meta) {
      if (currentStream !== quality) {
        audio.src = STREAMS[quality] + "?t=" + Date.now();
        currentStream = quality;
      }
      audio.play();
      updateMedia(meta.song, meta.artist, meta.image);
    },
    stop() {
      audio.pause();
      audio.src = "";
      currentStream = null;
    },
    setVolume(v) {
      audio.volume = v;
    }
  };
})();
</script>

<script type="text/babel">
const { useState, useEffect } = React;

const API_URL = "https://radio.retrodanceradio.com/api/nowplaying/retro_dance_radio";
const REQUESTS_EMBED_URL = "https://radio.retrodanceradio.com/public/retro_dance_radio/embed-requests";
const DEFAULT_COVER = "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?q=80&w=1000";

function App() {
  const [playing, setPlaying] = useState(false);
  const [quality, setQuality] = useState("high");
  const [volume, setVolume] = useState(0.8);
  const [tab, setTab] = useState("player");
  const [meta, setMeta] = useState({ song: "Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°â€¦", artist: "Retro Radio", image: DEFAULT_COVER, listeners: 0 });

  useEffect(() => {
    RadioPlayer.setVolume(volume);
  }, [volume]);

  useEffect(() => {
    const load = async () => {
      const r = await fetch(API_URL);
      const d = await r.json();
      if (d?.now_playing) {
        setMeta({
          song: d.now_playing.song?.title || "Ð­Ñ„Ð¸Ñ€",
          artist: d.now_playing.song?.artist || "Retro Radio",
          image: d.now_playing.song?.art || DEFAULT_COVER,
          listeners: d.listeners?.total || 0
        });
      }
    };
    load();
    const i = setInterval(load, 15000);
    return () => clearInterval(i);
  }, []);

  const toggle = () => {
    if (!playing) {
      RadioPlayer.play(quality, meta);
      setPlaying(true);
    } else {
      RadioPlayer.stop();
      setPlaying(false);
    }
  };

  return (
    <div className="min-h-screen flex flex-col items-center p-4">
      <header className="w-full max-w-xl flex justify-between items-center mb-6">
        <h1 className="font-black text-xl">Retro <span className="text-rose-500">Dance</span></h1>
        <span className="text-sm opacity-70">ðŸ‘¥ {meta.listeners}</span>
      </header>

      <nav className="flex gap-2 mb-6">
        {["player","history","request","chat"].map(t => (
          <button key={t}
            onClick={() => setTab(t)}
            className={`px-4 py-2 rounded-xl ${tab===t?"bg-rose-600":"bg-white/10"}`}>
            {t}
          </button>
        ))}
      </nav>

      {tab==="player" && (
        <div className="glass p-6 rounded-3xl w-full max-w-xl text-center">
          <img src={meta.image} className="w-60 h-60 mx-auto rounded-3xl mb-4 object-cover"/>
          <h2 className="font-black text-2xl">{meta.song}</h2>
          <p className="text-rose-400 mb-6">{meta.artist}</p>

          <button onClick={toggle}
            className="w-24 h-24 rounded-full bg-white text-black text-xl font-black">
            {playing ? "â– " : "â–¶"}
          </button>

          <div className="flex justify-center gap-4 mt-6">
            <button onClick={()=>setQuality("high")}>128K</button>
            <button onClick={()=>setQuality("low")}>32K</button>
          </div>

          <input type="range" min="0" max="1" step="0.01"
            value={volume}
            onChange={e=>setVolume(e.target.value)}
            className="w-full mt-4"/>
        </div>
      )}

      {tab==="request" && (
        <iframe src={REQUESTS_EMBED_URL} className="w-full max-w-xl h-[600px] rounded-3xl border-0"></iframe>
      )}
